module.exports = function (argv, boolean) {

    var last, escaped, options = { argv: [] };

    boolean = boolean || [];

    function addOption(opt, value) {
        if (/^-?[0-9]+\.?[0-9]*/.test(value)) {
            value = parseFloat(value);
        }
        options[opt] = value || ++options[opt] || 1;
        last = opt;
        if (!!~boolean.indexOf(opt)) {
            last = null;
        }
    }

    (argv || process.argv).forEach(function (arg) {
        if ('--' === arg && !escaped) {
            escaped = true;
        } else if (!escaped && /^--/.test(arg)) {
            addOption.apply(this, arg.slice(2).split('=', 2));
        } else if (!escaped && /^-/.test(arg)) {
            Array.prototype.slice.call(arg, 1).forEach(function (short) {
                addOption(short);
            });
        } else if (!escaped && last) {
            addOption(last, arg);
            last = null;
        } else {
            options.argv.push(arg);
        }
    });

    return options;

};

