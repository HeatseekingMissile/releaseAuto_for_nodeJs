var utils = require('./utils');

exports.gravatar = function (email, size, secure) {
    var endpoint = secure ? 'https://secure.gravatar.com/' : 'http://www.gravatar.com/avatar/'
      , hash = email.indexOf('@') !== -1 ? utils.md5(email.toLowerCase()) : email
      , url = endpoint + hash + '?d=mm';
    if (size) {
        url += '&s=' + size;
    }
    return url;
};

exports.analytics = function (id) {
    if (!id) return;
    var snippet = '<script type="text/javascript">\n'
                + 'var _gaq=[["_setAccount","' + id.trim() + '"],["_trackPageview"]];\n'
                + '(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;\n'
                + 'g.src=("https:"==location.protocol?"//ssl":"//www")+".google-analytics.com/ga.js";\n'
                + 's.parentNode.insertBefore(g,s)}(document,"script"));\n'
                + '</script>\n';
    return snippet;
};

exports.disqus = function (shortname, identifier, url) {
    var snippet = '<div id="disqus_thread"></div><script type="text/javascript">\n'
                + 'var disqus_shortname = "' + shortname.replace('"','\"') + '";\n';
    if (identifier) {
        snippet += 'var disqus_identifier = "' + identifier.replace('"','\"') + '";\n';
    }
    if (url) {
        snippet += 'var disqus_url = "' + url.replace('"','\"') + '";\n';
    }
    snippet += '(function() {\n var dsq = document.createElement("script"); dsq.type = "text/javascript";'
             + 'dsq.async = true; dsq.src = "http://' + shortname + '.disqus.com/embed.js";'
             + '(document.getElementsByTagName("head")[0] || '
             + 'document.getElementsByTagName("body")[0]).appendChild(dsq);\n })();\n</script>';
    return snippet;
};

exports.static = function (path) {
    path = path.trim();
    if (/\.css$/.test(path)) {
        return '<link rel="stylesheet" href="'+path+'">';
    } else if (/\.js$/.test(path)) {
        return '<script type="text/javascript" src="'+path+'"></script>';
    } else if (path.indexOf('favicon') !== -1) {
        return '<link rel="shortcut icon" href="'+path+'" />';
    }
};

