var assert = require('assert')
  , config = require('../').config;

describe('config', function () {
    it('should parse js files', function (done) {
        var parsed = config(__dirname + '/config/config.js', false);
        assert.equal('bar', parsed.foo);
        done();
    });
    it('should parse json files', function (done) {
        var parsed = config(__dirname + '/config/config.json', false);
        assert.equal('bar', parsed.foo);
        done();
    });
    it('should parse yaml files', function (done) {
        var parsed = config(__dirname + '/config/config.yaml', false);
        assert.equal('bar', parsed.foo);
        done();
    });
    it('should parse with a custom parser', function (done) {
        var parsed = config(__dirname + '/config/config.ini', false, {
            parser: function(str){var s=str.split('='),obj={};obj[s[0]]=s[1].trim();return obj;}
        });
        assert.equal('bar', parsed.foo);
        done();
    });
    it('should return environment config', function (done) {
        var parsed;
        process.env.NODE_ENV = null;
        parsed = config(__dirname + '/config/env.js');
        assert.equal('bar', parsed.foo);
        process.env.NODE_ENV = 'production';
        parsed = config(__dirname + '/config/env.js');
        assert.equal('foo', parsed.foo);
        assert.equal(1, parsed.a.b);
        assert.equal(4, parsed.a.c);
        parsed = config(__dirname + '/config/env.js', 'development');
        assert.equal('foobar', parsed.foo);
        process.env.NODE_ENV = 'unknown';
        parsed = config(__dirname + '/config/env.js');
        assert.equal('bar', parsed.foo);
        done();
    });
});

