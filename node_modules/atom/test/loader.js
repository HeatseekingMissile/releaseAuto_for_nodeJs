var assert = require('assert')
  , loader = require('../').loader;

describe('module loader', function () {
    it('should load all .js files in a dir', function (done) {
        var scope = {}, arg = {};
        loader(__dirname + '/loader', { scope: scope, args: [arg] });
        assert('foo' in scope);
        assert('foo' in arg);
        assert('bar' in scope);
        assert('bar' in arg);
        done();
    });
    it('should not fail if the dir doesn\'t exist and ignore=true', function (done) {
        assert.throws(function () {
            loader(__dirname + '/unknown');
        });
        loader(__dirname + '/unknown', { ignore: true });
        done();
    });
    it('should load modules in order', function (done) {
        var arg = {};
        loader(__dirname + '/loader/inorder', { args: arg, pre: ['b'] });
        assert.equal(true, arg.foo);
        assert.equal('a', arg.bar);
        arg = {};
        loader(__dirname + '/loader/inorder', { args: arg, post: ['a'] });
        assert.equal(true, arg.foo);
        assert.equal('a', arg.bar);
        done();
    });
});
